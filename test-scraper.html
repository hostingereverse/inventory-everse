<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Product Scraper - everse.in</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <h1>Product Scraper Test</h1>
    <p>Testing everse.in product scraping functionality</p>
    
    <div class="card mb-4">
      <div class="card-body">
        <div class="input-group mb-3">
          <input type="text" class="form-control" id="testSearchInput" placeholder="Enter product name (e.g., AIR 3S, NEO)">
          <button class="btn btn-primary" onclick="testSearch()">Test Search</button>
        </div>
        <div id="testResults" class="mt-3"></div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h5>Test Results Log</h5>
      </div>
      <div class="card-body">
        <div id="testLog" style="max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.9rem;"></div>
      </div>
    </div>
  </div>
  
  <script src="js/product-scraper.js"></script>
  <script>
    function log(message, type = 'info') {
      const logDiv = document.getElementById('testLog');
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
      logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }
    
    async function testSearch() {
      const searchTerm = document.getElementById('testSearchInput').value.trim();
      if (!searchTerm) {
        alert('Please enter a search term');
        return;
      }
      
      const resultsDiv = document.getElementById('testResults');
      resultsDiv.innerHTML = '<div class="text-center"><div class="spinner-border"></div><p>Searching...</p></div>';
      
      log(`Starting search for: "${searchTerm}"`, 'info');
      
      try {
        if (typeof ProductScraper === 'undefined') {
          throw new Error('ProductScraper is not loaded');
        }
        
        log('ProductScraper loaded successfully', 'success');
        log(`Searching: ${ProductScraper.BASE_URL}/search?q=${encodeURIComponent(searchTerm)}`, 'info');
        
        const startTime = Date.now();
        const result = await ProductScraper.searchProduct(searchTerm);
        const duration = Date.now() - startTime;
        
        log(`Search completed in ${duration}ms`, result.success ? 'success' : 'error');
        log(`Result: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');
        
        if (result.success && result.products && result.products.length > 0) {
          resultsDiv.innerHTML = `
            <div class="alert alert-success">
              <strong>✅ Success!</strong> Found ${result.products.length} product(s)
            </div>
            <div class="list-group mt-3">
              ${result.products.map((product, idx) => `
                <div class="list-group-item">
                  <h6>Product ${idx + 1}</h6>
                  <p><strong>Name:</strong> ${product.name}</p>
                  <p><strong>Description:</strong> ${product.description || 'N/A'}</p>
                  <p><strong>Price:</strong> ₹${product.price || 0}</p>
                  <p><strong>Relevance:</strong> ${product.relevance}</p>
                  ${product.url ? `<p><strong>URL:</strong> <a href="${product.url}" target="_blank">${product.url}</a></p>` : ''}
                </div>
              `).join('')}
            </div>
          `;
        } else {
          resultsDiv.innerHTML = `
            <div class="alert alert-warning">
              <strong>⚠️ No products found</strong>
              <p>Error: ${result.error || 'Unknown error'}</p>
              <p>This could mean:</p>
              <ul>
                <li>The product doesn't exist on everse.in</li>
                <li>CORS restrictions blocking the request</li>
                <li>Website structure changed</li>
                <li>Network error</li>
              </ul>
            </div>
          `;
        }
      } catch (error) {
        log(`Error: ${error.message}`, 'error');
        console.error('Test error:', error);
        resultsDiv.innerHTML = `
          <div class="alert alert-danger">
            <strong>❌ Test Failed</strong>
            <p>${error.message}</p>
            <p>Check browser console for details.</p>
          </div>
        `;
      }
    }
    
    // Test on page load
    document.addEventListener('DOMContentLoaded', () => {
      log('Test page loaded', 'info');
      log('ProductScraper available: ' + (typeof ProductScraper !== 'undefined'), 
          typeof ProductScraper !== 'undefined' ? 'success' : 'error');
      
      if (typeof ProductScraper !== 'undefined') {
        log(`Base URL: ${ProductScraper.BASE_URL}`, 'info');
        log(`CORS Proxy: ${ProductScraper.CORS_PROXY}`, 'info');
      }
      
      // Allow Enter key to trigger search
      document.getElementById('testSearchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          testSearch();
        }
      });
    });
  </script>
</body>
</html>

