---
export interface Props {
  headers: string[];
  rows: any[][];
  searchable?: boolean;
  filterable?: boolean;
  pagination?: boolean;
}

const { headers, rows, searchable = true, filterable = false, pagination = true } = Astro.props;
---

<div 
  x-data="{
    search: '',
    currentPage: 1,
    itemsPerPage: 20,
    get filteredRows() {
      if (!this.search) return this.rows;
      const searchLower = this.search.toLowerCase();
      return this.rows.filter(row => 
        row.some(cell => String(cell).toLowerCase().includes(searchLower))
      );
    },
    get paginatedRows() {
      const start = (this.currentPage - 1) * this.itemsPerPage;
      return this.filteredRows.slice(start, start + this.itemsPerPage);
    },
    get totalPages() {
      return Math.ceil(this.filteredRows.length / this.itemsPerPage);
    },
    rows: [
      ['Loading...']
    ]
  }"
  x-init="rows = JSON.parse(document.querySelector('[data-rows]')?.textContent || '[]')"
>
  {searchable && (
    <div class="mb-4">
        <input
        type="text"
        x-model="search"
        placeholder="ðŸ” Search..."
        class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:border-blue-500 focus:outline-none"
      />
    </div>
  )}

  <div class="overflow-x-auto">
    <table class="w-full border-collapse bg-white dark:bg-gray-800 rounded-lg shadow">
      <thead>
        <tr class="bg-gray-100 dark:bg-gray-700">
          {headers.map((header) => (
            <th class="px-4 py-3 text-left font-semibold border-b border-gray-200 dark:border-gray-600">
              {header}
            </th>
          ))}
        </tr>
      </thead>
      <tbody>
        <template x-for="(row, idx) in paginatedRows" :key="idx">
          <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
            <template x-for="(cell, cellIdx) in row" :key="cellIdx">
              <td class="px-4 py-3" x-text="cell"></td>
            </template>
          </tr>
        </template>
      </tbody>
    </table>
  </div>

  {pagination && (
    <div class="mt-4 flex items-center justify-between">
      <div class="text-sm text-gray-600 dark:text-gray-400">
        Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
        <span x-text="Math.min(currentPage * itemsPerPage, filteredRows.length)"></span> of
        <span x-text="filteredRows.length"></span> results
      </div>
      <div class="flex gap-2">
        <button
          @click="currentPage = Math.max(1, currentPage - 1)"
          :disabled="currentPage === 1"
          class="px-4 py-2 border rounded disabled:opacity-50"
        >
          Previous
        </button>
        <button
          @click="currentPage = Math.min(totalPages, currentPage + 1)"
          :disabled="currentPage === totalPages"
          class="px-4 py-2 border rounded disabled:opacity-50"
        >
          Next
        </button>
      </div>
    </div>
  )}

  <script type="application/json" data-rows set:html={JSON.stringify(rows)} />
</div>

